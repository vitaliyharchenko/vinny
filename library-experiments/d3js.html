<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <title>Граф математических тем</title>
        <style>
            body {
                margin: 0;
                overflow: hidden;
            }
            .links line {
                stroke: #999;
                stroke-opacity: 0.6;
            }
            .nodes circle {
                stroke: #fff;
                stroke-width: 1.5px;
            }
            text {
                font-family: sans-serif;
                font-size: 12px;
                pointer-events: none;
            }
        </style>
    </head>
    <body>
        <!-- Подключение D3.js -->
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script>
            // Данные графа
            var graph = {
                nodes: [
                    { id: 1, name: "Счет до 20", group: 1 },
                    {
                        id: 2,
                        name: "Сложение и вычитание в пределах 20",
                        group: 1,
                    },
                    {
                        id: 3,
                        name: "Простые геометрические фигуры (круг, квадрат, треугольник)",
                        group: 1,
                    },
                    { id: 4, name: "Счет до 100", group: 2 },
                    {
                        id: 5,
                        name: "Сложение и вычитание в пределах 100",
                        group: 2,
                    },
                    {
                        id: 6,
                        name: "Умножение и деление на числа 2, 3, 4, 5 и 10",
                        group: 2,
                    },
                    {
                        id: 7,
                        name: "Единицы измерения длины (см, м)",
                        group: 2,
                    },
                    { id: 8, name: "Таблица умножения", group: 3 },
                    { id: 9, name: "Деление с остатком", group: 3 },
                    { id: 10, name: "Дроби как части целого", group: 3 },
                    { id: 11, name: "Периметр геометрических фигур", group: 3 },
                    {
                        id: 12,
                        name: "Сложение и вычитание дробей с одинаковыми знаменателями",
                        group: 4,
                    },
                    {
                        id: 13,
                        name: "Площадь прямоугольника и квадрата",
                        group: 4,
                    },
                    {
                        id: 14,
                        name: "Чтение и запись многозначных чисел",
                        group: 4,
                    },
                    { id: 15, name: "Натуральные числа и ноль", group: 5 },
                    { id: 16, name: "Отрицательные числа", group: 5 },
                    { id: 17, name: "Десятичные дроби", group: 5 },
                    { id: 18, name: "Простейшие уравнения", group: 5 },
                    { id: 19, name: "Отношения и пропорции", group: 6 },
                    { id: 20, name: "Проценты", group: 6 },
                    { id: 21, name: "Площади многоугольников", group: 6 },
                    {
                        id: 22,
                        name: "Алгебраические выражения с переменными",
                        group: 6,
                    },
                    {
                        id: 23,
                        name: "Линейные уравнения с одной переменной",
                        group: 7,
                    },
                    { id: 24, name: "Системы линейных уравнений", group: 7 },
                    { id: 25, name: "Функции и их графики", group: 7 },
                    {
                        id: 26,
                        name: "Геометрия прямоугольного треугольника",
                        group: 7,
                    },
                    { id: 27, name: "Теорема Пифагора", group: 7 },
                    { id: 28, name: "Квадратные уравнения", group: 8 },
                    { id: 29, name: "Иррациональные числа", group: 8 },
                    {
                        id: 30,
                        name: "Геометрические преобразования (симметрия, повороты)",
                        group: 8,
                    },
                    { id: 31, name: "Объемы геометрических тел", group: 8 },
                    {
                        id: 32,
                        name: "Тригонометрические функции (синус, косинус, тангенс)",
                        group: 9,
                    },
                    {
                        id: 33,
                        name: "Элементы статистики и теории вероятностей",
                        group: 9,
                    },
                    {
                        id: 34,
                        name: "Координатная плоскость и графики функций",
                        group: 9,
                    },
                    {
                        id: 35,
                        name: "Рациональные выражения и их преобразования",
                        group: 9,
                    },
                ],
                links: [
                    { source: 1, target: 2 },
                    { source: 1, target: 4 },
                    { source: 4, target: 5 },
                    { source: 5, target: 6 },
                    { source: 6, target: 8 },
                    { source: 8, target: 9 },
                    { source: 9, target: 10 },
                    { source: 3, target: 11 },
                    { source: 10, target: 12 },
                    { source: 11, target: 13 },
                    { source: 4, target: 14 },
                    { source: 15, target: 16 },
                    { source: 10, target: 17 },
                    { source: 2, target: 18 },
                    { source: 5, target: 18 },
                    { source: 6, target: 18 },
                    { source: 9, target: 19 },
                    { source: 10, target: 19 },
                    { source: 19, target: 20 },
                    { source: 13, target: 21 },
                    { source: 18, target: 22 },
                    { source: 22, target: 23 },
                    { source: 23, target: 24 },
                    { source: 22, target: 25 },
                    { source: 3, target: 26 },
                    { source: 11, target: 26 },
                    { source: 26, target: 27 },
                    { source: 23, target: 28 },
                    { source: 28, target: 29 },
                    { source: 3, target: 30 },
                    { source: 11, target: 30 },
                    { source: 21, target: 31 },
                    { source: 27, target: 32 },
                    { source: 20, target: 33 },
                    { source: 10, target: 33 },
                    { source: 25, target: 34 },
                    { source: 22, target: 35 },
                ],
            };

            // Размеры SVG
            var width = window.innerWidth,
                height = window.innerHeight;

            // Цветовая шкала
            var color = d3.scaleOrdinal(d3.schemeCategory10);

            // Создание симуляции
            var simulation = d3
                .forceSimulation()
                .force(
                    "link",
                    d3
                        .forceLink()
                        .id(function (d) {
                            return d.id;
                        })
                        .distance(150)
                )
                .force("charge", d3.forceManyBody().strength(-500))
                .force("center", d3.forceCenter(width / 2, height / 2));

            // Создание SVG
            var svg = d3
                .select("body")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            // Создание линий для связей
            var link = svg
                .append("g")
                .attr("class", "links")
                .selectAll("line")
                .data(graph.links)
                .enter()
                .append("line")
                .attr("stroke-width", 2);

            // Создание узлов
            var node = svg
                .append("g")
                .attr("class", "nodes")
                .selectAll("g")
                .data(graph.nodes)
                .enter()
                .append("g");

            // Добавление кругов для узлов
            var circles = node
                .append("circle")
                .attr("r", 15)
                .attr("fill", function (d) {
                    return color(d.group);
                })
                .call(
                    d3
                        .drag()
                        .on("start", dragstarted)
                        .on("drag", dragged)
                        .on("end", dragended)
                );

            // Добавление текстовых меток
            var labels = node
                .append("text")
                .attr("dx", 16)
                .attr("dy", 4)
                .text(function (d) {
                    return d.name;
                });

            // Запуск симуляции
            simulation.nodes(graph.nodes).on("tick", ticked);

            simulation.force("link").links(graph.links);

            // Функция обновления позиции элементов
            function ticked() {
                link.attr("x1", function (d) {
                    return d.source.x;
                })
                    .attr("y1", function (d) {
                        return d.source.y;
                    })
                    .attr("x2", function (d) {
                        return d.target.x;
                    })
                    .attr("y2", function (d) {
                        return d.target.y;
                    });

                node.attr("transform", function (d) {
                    return "translate(" + d.x + "," + d.y + ")";
                });
            }

            // Функции перетаскивания
            function dragstarted(d) {
                if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(d) {
                d.fx = d3.event.x;
                d.fy = d3.event.y;
            }

            function dragended(d) {
                if (!d3.event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        </script>
    </body>
</html>
